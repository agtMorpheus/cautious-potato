/**
 * Dark Mode Consistency Fixes
 * 
 * This file addresses dark mode inconsistencies across all elements
 * and ensures proper theming throughout the application.
 */

/* ==================== GLOBAL DARK MODE FIXES ==================== */

[data-theme="dark"] {
    /* Enhanced color scheme consistency */
    color-scheme: dark;
}

/* ==================== MISSING DARK MODE OVERRIDES ==================== */

/* Help View Dark Mode */
[data-theme="dark"] .help-steps li::before {
    background: var(--color-primary);
    color: var(--color-white);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .help-steps code {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    color: var(--color-primary);
}

[data-theme="dark"] .shortcut-key {
    background: var(--color-surface);
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .module-icon {
    background: rgba(255, 255, 255, 0.1);
}

/* ==================== LOGS VIEW DARK MODE FIXES ==================== */

[data-theme="dark"] .log-table-container {
    border-color: rgba(255, 255, 255, 0.1);
    background: var(--color-surface);
}

[data-theme="dark"] .full-height-card {
    background: var(--color-surface);
    border-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .full-height-card .card-body {
    background: var(--color-surface);
}

/* Log table styling */
[data-theme="dark"] .log-table {
    background: var(--color-surface);
    color: var(--color-text);
}

[data-theme="dark"] .log-table th {
    background: rgba(255, 255, 255, 0.05);
    border-bottom-color: rgba(255, 255, 255, 0.1);
    color: var(--color-text);
}

[data-theme="dark"] .log-table td {
    border-bottom-color: rgba(255, 255, 255, 0.1);
    color: var(--color-text);
}

[data-theme="dark"] .log-table tbody tr:hover {
    background: rgba(255, 255, 255, 0.05);
}

/* Monospace font elements in logs */
[data-theme="dark"] .font-mono {
    color: rgba(255, 255, 255, 0.9);
    background: rgba(255, 255, 255, 0.05);
    padding: 2px 4px;
    border-radius: 3px;
}

/* Log level indicators */
[data-theme="dark"] .log-level-error {
    color: var(--color-error);
    background: rgba(192, 21, 47, 0.15);
}

[data-theme="dark"] .log-level-warning {
    color: var(--color-warning);
    background: rgba(168, 75, 47, 0.15);
}

[data-theme="dark"] .log-level-info {
    color: var(--color-info);
    background: rgba(98, 108, 113, 0.15);
}

[data-theme="dark"] .log-level-debug {
    color: rgba(255, 255, 255, 0.7);
    background: rgba(255, 255, 255, 0.1);
}

/* Templates View Dark Mode */
[data-theme="dark"] .template-item {
    background: var(--color-surface);
    border-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .template-item:hover,
[data-theme="dark"] .template-item:focus-visible {
    border-color: var(--color-primary);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .template-icon {
    background: rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] .template-item:hover .template-icon,
[data-theme="dark"] .template-item:focus-visible .template-icon {
    background: rgba(255, 255, 255, 0.1);
}

/* ==================== ASSETS VIEW DARK MODE FIXES ==================== */

[data-theme="dark"] .asset-stat-card {
    background: var(--color-surface);
    border-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .asset-stat-card:hover {
    box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.4);
    border-color: var(--color-primary);
}

[data-theme="dark"] .asset-code,
[data-theme="dark"] .asset-id {
    background: rgba(255, 255, 255, 0.1);
    color: var(--color-text);
    border-color: rgba(255, 255, 255, 0.2);
}

/* Fix hardcoded shadow in assets.css */
[data-theme="dark"] .asset-stat-card:hover {
    box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.4);
    transform: translateY(-2px);
}

/* Asset table improvements */
[data-theme="dark"] .asset-table th {
    background: rgba(255, 255, 255, 0.05);
    border-bottom-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .asset-table td {
    border-bottom-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .asset-table tbody tr:hover td {
    background: rgba(255, 255, 255, 0.05);
}

/* Asset filters */
[data-theme="dark"] .asset-filters {
    background: var(--color-surface);
    border-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .asset-filters .form-input,
[data-theme="dark"] .asset-filters .form-select {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.2);
    color: var(--color-text);
}

[data-theme="dark"] .asset-filters .form-input:focus,
[data-theme="dark"] .asset-filters .form-select:focus {
    background: rgba(255, 255, 255, 0.1);
    border-color: var(--color-primary);
    box-shadow: 0 0 0 1px var(--color-primary);
}

/* Asset list container */
[data-theme="dark"] .asset-list-container {
    background: rgba(30, 41, 59, 0.8);
    border-color: rgba(255, 255, 255, 0.1);
}

/* Asset status indicators */
[data-theme="dark"] .asset-status.status-active {
    background: rgba(33, 128, 141, 0.2);
    color: var(--color-success);
}

[data-theme="dark"] .asset-status.status-inactive {
    background: rgba(168, 75, 47, 0.2);
    color: var(--color-warning);
}

[data-theme="dark"] .asset-status.status-decommissioned {
    background: rgba(192, 21, 47, 0.2);
    color: var(--color-error);
}

/* Asset action buttons */
[data-theme="dark"] .asset-module .btn-icon:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--color-text);
    border-color: rgba(255, 255, 255, 0.2);
}

/* Asset empty state */
[data-theme="dark"] .asset-empty-state .empty-icon {
    color: rgba(255, 255, 255, 0.3);
}

/* ==================== SETTINGS VIEW DARK MODE FIXES ==================== */

[data-theme="dark"] .settings-group {
    background: var(--color-surface);
    border-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .storage-mode-content {
    background: var(--color-surface);
    border-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .storage-mode-option input:checked + .storage-mode-content {
    background: rgba(var(--color-primary-rgb), 0.1);
    border-color: var(--color-primary);
    box-shadow: 0 0 0 1px var(--color-primary);
}

[data-theme="dark"] .storage-mode-option input:checked + .storage-mode-content .storage-mode-icon {
    color: var(--color-primary);
}

[data-theme="dark"] .storage-mode-text strong {
    color: var(--color-text);
}

[data-theme="dark"] .storage-mode-text span {
    color: rgba(255, 255, 255, 0.7);
}

[data-theme="dark"] .sync-status-display {
    background: var(--color-surface);
    border-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .sync-status-indicator {
    color: var(--color-success);
}

[data-theme="dark"] .sync-last-time {
    color: rgba(255, 255, 255, 0.7);
}

[data-theme="dark"] .settings-label {
    color: var(--color-text);
}

[data-theme="dark"] .settings-desc {
    color: rgba(255, 255, 255, 0.7);
}

[data-theme="dark"] .checkbox-label {
    color: var(--color-text);
}

[data-theme="dark"] .backup-actions .btn {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    color: var(--color-text);
}

[data-theme="dark"] .backup-actions .btn:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: var(--color-primary);
}

/* ==================== ENHANCED GLASSMORPHISM DARK MODE ==================== */

[data-theme="dark"] .sidebar {
    background: rgba(2, 6, 23, 0.9);
    border-right-color: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
}

[data-theme="dark"] .cmd-header {
    background: rgba(2, 6, 23, 0.9);
    border-bottom-color: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
}

[data-theme="dark"] .cmd-footer {
    background: rgba(2, 6, 23, 0.9);
    border-top-color: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
}

/* ==================== ENHANCED CARD DARK MODE ==================== */

[data-theme="dark"] .card {
    background: rgba(30, 41, 59, 0.8);
    border-color: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
}

[data-theme="dark"] .card:hover {
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

/* ==================== ENHANCED FORM DARK MODE ==================== */

[data-theme="dark"] .form-control {
    background: rgba(30, 41, 59, 0.6);
    border-color: rgba(255, 255, 255, 0.2);
    color: var(--color-text);
}

[data-theme="dark"] .form-control:focus {
    background: rgba(30, 41, 59, 0.8);
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.3);
}

[data-theme="dark"] .form-control::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

[data-theme="dark"] .form-control:disabled {
    background: rgba(30, 41, 59, 0.3);
    opacity: 0.6;
}

/* ==================== ENHANCED BUTTON DARK MODE ==================== */

[data-theme="dark"] .btn--secondary {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    color: var(--color-text);
}

[data-theme="dark"] .btn--secondary:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.15);
    border-color: var(--color-primary);
}

[data-theme="dark"] .btn--outline {
    border-color: rgba(255, 255, 255, 0.3);
    color: var(--color-text);
}

[data-theme="dark"] .btn--outline:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.1);
    border-color: var(--color-primary);
    color: var(--color-primary);
}

[data-theme="dark"] .btn--ghost:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.1);
}

/* ==================== ENHANCED TABLE DARK MODE ==================== */

[data-theme="dark"] .table {
    background: var(--color-surface);
}

[data-theme="dark"] .table__wrapper {
    border-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .table__head {
    background: rgba(255, 255, 255, 0.05);
    border-bottom-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .table__th,
[data-theme="dark"] .table__td {
    border-bottom-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .table__tr:hover {
    background: rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] .table--striped .table__tr:nth-child(even) {
    background: rgba(255, 255, 255, 0.03);
}

[data-theme="dark"] .table--striped .table__tr:nth-child(even):hover {
    background: rgba(255, 255, 255, 0.08);
}

[data-theme="dark"] .table__pagination {
    background: rgba(255, 255, 255, 0.05);
    border-top-color: rgba(255, 255, 255, 0.1);
}

/* ==================== ENHANCED MODAL DARK MODE ==================== */

[data-theme="dark"] .modal {
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}

[data-theme="dark"] .modal__content {
    background: var(--color-surface);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
}

[data-theme="dark"] .drawer {
    background: var(--color-surface);
    border-left-color: rgba(255, 255, 255, 0.1);
    box-shadow: -10px 0 30px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .popover {
    background: var(--color-surface);
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
}

/* ==================== ENHANCED ALERT DARK MODE ==================== */

[data-theme="dark"] .alert--success {
    background: rgba(33, 128, 141, 0.15);
    border-left-color: var(--color-success);
}

[data-theme="dark"] .alert--error {
    background: rgba(192, 21, 47, 0.15);
    border-left-color: var(--color-error);
}

[data-theme="dark"] .alert--warning {
    background: rgba(168, 75, 47, 0.15);
    border-left-color: var(--color-warning);
}

[data-theme="dark"] .alert--info {
    background: rgba(98, 108, 113, 0.15);
    border-left-color: var(--color-info);
}

[data-theme="dark"] .toast {
    background: var(--color-surface);
    border-color: rgba(255, 255, 255, 0.1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
}

/* ==================== ENHANCED STATUS DARK MODE ==================== */

[data-theme="dark"] .badge--success {
    background: rgba(33, 128, 141, 0.2);
    border-color: rgba(33, 128, 141, 0.4);
}

[data-theme="dark"] .badge--error {
    background: rgba(192, 21, 47, 0.2);
    border-color: rgba(192, 21, 47, 0.4);
}

[data-theme="dark"] .badge--warning {
    background: rgba(168, 75, 47, 0.2);
    border-color: rgba(168, 75, 47, 0.4);
}

[data-theme="dark"] .badge--info {
    background: rgba(98, 108, 113, 0.2);
    border-color: rgba(98, 108, 113, 0.4);
}

[data-theme="dark"] .badge--neutral {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
}

[data-theme="dark"] .progress {
    background: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .activity-indicator {
    background: rgba(255, 255, 255, 0.08);
}

[data-theme="dark"] .status-group {
    background: var(--color-surface);
    border-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .status-group__item {
    border-bottom-color: rgba(255, 255, 255, 0.1);
}

/* ==================== ENHANCED DASHBOARD DARK MODE ==================== */

[data-theme="dark"] .dashboard-header-card {
    background: rgba(30, 41, 59, 0.8);
    border-color: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
}

[data-theme="dark"] .metric-card {
    background: rgba(30, 41, 59, 0.8);
    border-color: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
}

[data-theme="dark"] .metric-card:hover {
    border-color: var(--color-primary);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .action-card {
    background: rgba(30, 41, 59, 0.8);
    border-color: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
}

[data-theme="dark"] .action-card:hover:not(:disabled) {
    border-color: var(--color-primary);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .activity-feed-list {
    background: rgba(30, 41, 59, 0.8);
    border-color: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
}

[data-theme="dark"] .activity-item {
    border-bottom-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .activity-item:hover {
    background: rgba(255, 255, 255, 0.05);
}

/* ==================== ENHANCED NAVIGATION DARK MODE ==================== */

[data-theme="dark"] .sidebar-header {
    border-bottom-color: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .sidebar-footer {
    border-top-color: rgba(255, 255, 255, 0.1);
    background: rgba(2, 6, 23, 0.8);
}

[data-theme="dark"] .nav-link:hover {
    background: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .nav-link.active {
    background: rgba(var(--color-primary-rgb), 0.2);
}

[data-theme="dark"] .sidebar-toggle:hover {
    background: rgba(255, 255, 255, 0.1);
}

/* ==================== ENHANCED SEARCH DARK MODE ==================== */

[data-theme="dark"] .cmd-search-input {
    background: rgba(30, 41, 59, 0.8);
    border-color: rgba(255, 255, 255, 0.2);
}

[data-theme="dark"] .cmd-search-input:hover {
    background: rgba(30, 41, 59, 0.9);
}

[data-theme="dark"] .cmd-search-input:focus {
    background: rgba(30, 41, 59, 1);
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.3);
}

[data-theme="dark"] .cmd-search-shortcut {
    background: rgba(2, 6, 23, 0.8);
    border-color: rgba(255, 255, 255, 0.2);
}

/* ==================== ENHANCED STATUS INDICATORS DARK MODE ==================== */

[data-theme="dark"] .cmd-status {
    background: rgba(30, 41, 59, 0.8);
    border-color: rgba(255, 255, 255, 0.2);
}

[data-theme="dark"] .breadcrumb-root {
    background: rgba(30, 41, 59, 0.8);
    border-color: rgba(255, 255, 255, 0.2);
}

[data-theme="dark"] .cmd-btn-icon:hover {
    background: rgba(255, 255, 255, 0.1);
}

/* ==================== ENHANCED FILE UPLOAD DARK MODE ==================== */

[data-theme="dark"] .file-upload-area {
    border-color: rgba(255, 255, 255, 0.3);
    background: rgba(30, 41, 59, 0.6);
}

[data-theme="dark"] .file-upload-area:hover,
[data-theme="dark"] .file-upload-area.drag-over {
    border-color: var(--color-primary);
    background: rgba(var(--color-primary-rgb), 0.1);
}

/* ==================== ENHANCED WELCOME MESSAGE DARK MODE ==================== */

[data-theme="dark"] .welcome-message-container {
    background: rgba(30, 41, 59, 0.8);
    border-color: rgba(255, 255, 255, 0.2);
}

[data-theme="dark"] .welcome-message-counter {
    background: rgba(255, 255, 255, 0.1);
}

/* ==================== ENHANCED SCROLLBAR DARK MODE ==================== */

[data-theme="dark"] ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

[data-theme="dark"] ::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
}

[data-theme="dark"] ::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
}

[data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.3);
}

/* ==================== ENHANCED SELECTION DARK MODE ==================== */

[data-theme="dark"] ::selection {
    background: rgba(var(--color-primary-rgb), 0.3);
    color: var(--color-text);
}

[data-theme="dark"] ::-moz-selection {
    background: rgba(var(--color-primary-rgb), 0.3);
    color: var(--color-text);
}

/* ==================== ENHANCED FOCUS INDICATORS DARK MODE ==================== */

[data-theme="dark"] *:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
    box-shadow: 0 0 0 4px rgba(var(--color-primary-rgb), 0.3);
}

/* ==================== HARDCODED VALUE FIXES ==================== */

/* Fix hardcoded rgba(0,0,0,0.2) values throughout the application */
[data-theme="dark"] .alert__close:hover {
    background: rgba(255, 255, 255, 0.1);
}

/* Fix protokoll.css hardcoded shadows */
[data-theme="dark"] .protokoll-input:focus {
    box-shadow: 0 0 0 1px var(--color-primary), 0 4px 12px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .protokoll-section {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .protokoll-submit-btn {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
}

/* Fix hr-module.css hardcoded shadows */
[data-theme="dark"] .hr-card:hover {
    box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .hr-badge {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .hr-action-btn {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
}

/* Fix cell-mapper.css hardcoded backgrounds */
[data-theme="dark"] .cell-mapper-overlay {
    background: rgba(0, 0, 0, 0.8);
}

[data-theme="dark"] .cell-mapper-input {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    color: var(--color-text);
}

/* Fix validator-ui.css hardcoded backgrounds */
[data-theme="dark"] .validator-error-display {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
}

[data-theme="dark"] .validator-result-item {
    background: rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] .validator-overlay {
    background: rgba(0, 0, 0, 0.8);
}

/* Fix styles.css hardcoded shadow */
[data-theme="dark"] .main-search-input:focus {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

/* ==================== STANDARDIZE DARK MODE SELECTORS ==================== */

/* Ensure all components use [data-theme="dark"] as primary selector */
/* These rules provide fallback support for [data-color-scheme="dark"] */

/* Note: [data-color-scheme="dark"] selectors are handled by existing CSS files */
/* This ensures consistency between [data-theme="dark"] and [data-color-scheme="dark"] patterns */
/* All components should primarily use [data-theme="dark"] as documented in the standardization guide */

/* ==================== ENHANCED TRANSITIONS FOR DARK MODE ==================== */

[data-theme="dark"] * {
    transition: background-color var(--duration-normal), 
                border-color var(--duration-normal), 
                color var(--duration-normal),
                box-shadow var(--duration-normal);
}

/* ==================== PRINT STYLES FOR DARK MODE ==================== */

@media print {
    [data-theme="dark"] * {
        background: white !important;
        color: black !important;
        border-color: #ccc !important;
        box-shadow: none !important;
    }
}

/* ==================== HIGH CONTRAST DARK MODE ==================== */

[data-theme="dark"][data-high-contrast="true"] {
    --color-text: #ffffff;
    --color-background: #000000;
    --color-surface: #1a1a1a;
    --color-border-std: #ffffff;
    --color-primary: #00ffff;
}

[data-theme="dark"][data-high-contrast="true"] .card,
[data-theme="dark"][data-high-contrast="true"] .modal__content,
[data-theme="dark"][data-high-contrast="true"] .form-control {
    border-width: 2px;
    border-style: solid;
}

/* ==================== VENDOR CSS DARK MODE FIXES ==================== */

/* PHPUnit Coverage Reports */
[data-theme="dark"] .phpunit-coverage {
    background: var(--color-surface) !important;
    color: var(--color-text) !important;
}

[data-theme="dark"] .phpunit-coverage table {
    background: var(--color-surface) !important;
    border-color: rgba(255, 255, 255, 0.1) !important;
}

[data-theme="dark"] .phpunit-coverage th,
[data-theme="dark"] .phpunit-coverage td {
    background: var(--color-surface) !important;
    color: var(--color-text) !important;
    border-color: rgba(255, 255, 255, 0.1) !important;
}

[data-theme="dark"] .phpunit-coverage .covered {
    background: rgba(33, 128, 141, 0.2) !important;
}

[data-theme="dark"] .phpunit-coverage .uncovered {
    background: rgba(192, 21, 47, 0.2) !important;
}

/* D3.js Charts Dark Mode */
[data-theme="dark"] .nvd3 .nv-axis {
    fill: var(--color-text) !important;
}

[data-theme="dark"] .nvd3 .nv-axis text {
    fill: var(--color-text) !important;
}

[data-theme="dark"] .nvd3 .nv-axis path {
    stroke: rgba(255, 255, 255, 0.3) !important;
}

[data-theme="dark"] .nvd3 .nv-bars rect {
    fill: var(--color-primary) !important;
}

[data-theme="dark"] .nvd3 .nv-bars text {
    fill: var(--color-text) !important;
}

[data-theme="dark"] .nvd3 .nv-legend text {
    fill: var(--color-text) !important;
}

/* ==================== JAVASCRIPT THEME MANAGEMENT FIXES ==================== */

/* Ensure theme switching doesn't cause flicker */
[data-theme="dark"] {
    color-scheme: dark;
}

[data-theme="light"] {
    color-scheme: light;
}

/* Theme transition smoothing */
html[data-theme-switching="true"] * {
    transition: background-color 0ms, color 0ms, border-color 0ms !important;
}

/* ==================== ACCESSIBILITY ENHANCEMENTS ==================== */

/* Enhanced focus indicators for dark mode */
[data-theme="dark"] *:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
    box-shadow: 0 0 0 4px rgba(var(--color-primary-rgb), 0.3);
}

/* High contrast mode improvements */
[data-theme="dark"][data-high-contrast="true"] {
    --color-text: #ffffff;
    --color-background: #000000;
    --color-surface: #1a1a1a;
    --color-border-std: #ffffff;
    --color-primary: #00ffff;
}

[data-theme="dark"][data-high-contrast="true"] .card,
[data-theme="dark"][data-high-contrast="true"] .modal__content,
[data-theme="dark"][data-high-contrast="true"] .form-control {
    border-width: 2px;
    border-style: solid;
}

/* Screen reader improvements */
[data-theme="dark"] .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* ==================== PERFORMANCE OPTIMIZATIONS ==================== */

/* GPU acceleration for smooth transitions */
[data-theme="dark"] .card,
[data-theme="dark"] .modal,
[data-theme="dark"] .btn {
    transform: translateZ(0);
    will-change: background-color, border-color, box-shadow;
}

/* ==================== REDUCED MOTION DARK MODE ==================== */

@media (prefers-reduced-motion: reduce) {
    [data-theme="dark"] * {
        transition: none !important;
        animation: none !important;
    }
    
    [data-theme="dark"] .card,
    [data-theme="dark"] .modal,
    [data-theme="dark"] .btn {
        will-change: auto;
    }
}

/* ==================== DARK MODE TESTING UTILITIES ==================== */

/* Debug mode for dark mode development */
[data-theme="dark"][data-debug="true"] * {
    outline: 1px solid rgba(255, 0, 255, 0.3) !important;
}

[data-theme="dark"][data-debug="true"] *:hover {
    outline: 2px solid rgba(255, 255, 0, 0.5) !important;
}