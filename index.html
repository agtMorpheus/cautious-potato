<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Abrechnung aus Protokoll</title>
    <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
    <header class="app-header">
        <h1>Abrechnung aus Prüfprotokoll</h1>
        <p class="app-tagline">
            Excel‑basierte Abrechnungserstellung aus <code>protokoll.xlsx</code> – vollständig im Browser.
        </p>
    </header>

    <main class="app-main" aria-live="polite">
        <!-- Global message container -->
        <div id="global-messages" class="messages" aria-live="assertive"></div>

        <!-- Import Section -->
        <section id="import-section" class="panel" aria-labelledby="import-heading">
            <header class="panel-header">
                <h2 id="import-heading">1. Protokoll importieren</h2>
                <p class="panel-description">
                    Laden Sie ein gültiges <code>protokoll.xlsx</code> aus der Vorlage.
                </p>
            </header>

            <div class="panel-body">
                <div class="form-row">
                    <label for="file-input">Protokoll-Datei (.xlsx)</label>
                    <input
                        id="file-input"
                        type="file"
                        accept=".xlsx"
                        aria-describedby="file-help"
                    />
                    <p id="file-help" class="hint">
                        Die Datei wird nur lokal im Browser verarbeitet und nicht hochgeladen.
                    </p>
                </div>

                <div class="actions">
                    <button id="import-button" type="button">Datei importieren</button>
                </div>

                <div class="status-row">
                    <span class="status-indicator status-idle" id="import-status"></span>
                    <p id="import-message" class="status-message">Noch keine Datei importiert.</p>
                </div>

                <div id="import-summary" class="summary" aria-live="polite" hidden></div>
            </div>
        </section>

        <!-- Generate Section -->
        <section id="generate-section" class="panel" aria-labelledby="generate-heading">
            <header class="panel-header">
                <h2 id="generate-heading">2. Abrechnung erzeugen</h2>
                <p class="panel-description">
                    Positionen werden aggregiert und in die Abrechnungsvorlage übernommen.
                </p>
            </header>

            <div class="panel-body">
                <div class="actions">
                    <button id="generate-button" type="button" disabled>
                        Abrechnung erzeugen
                    </button>
                </div>

                <div class="status-row">
                    <span class="status-indicator status-idle" id="generate-status"></span>
                    <p id="generate-message" class="status-message">Noch keine Abrechnung erzeugt.</p>
                </div>

                <div id="generate-summary" class="summary" aria-live="polite" hidden></div>
            </div>
        </section>

        <!-- Export Section -->
        <section id="export-section" class="panel" aria-labelledby="export-heading">
            <header class="panel-header">
                <h2 id="export-heading">3. Abrechnung exportieren</h2>
                <p class="panel-description">
                    Laden Sie die fertige <code>abrechnung.xlsx</code> herunter.
                </p>
            </header>

            <div class="panel-body">
                <div class="actions">
                    <button id="export-button" type="button" disabled>
                        Abrechnung herunterladen
                    </button>
                </div>

                <div class="status-row">
                    <span class="status-indicator status-idle" id="export-status"></span>
                    <p id="export-message" class="status-message">Noch keine Datei exportiert.</p>
                </div>

                <dl id="export-summary" class="summary" aria-live="polite" hidden>
                    <div class="summary-item">
                        <dt>Letzter Export</dt>
                        <dd id="export-last-date">–</dd>
                    </div>
                    <div class="summary-item">
                        <dt>Dateigröße</dt>
                        <dd id="export-last-size">–</dd>
                    </div>
                </dl>
            </div>
        </section>

        <!-- Reset / Debug Section -->
        <section id="reset-section" class="panel panel-secondary" aria-label="Anwendung zurücksetzen">
            <div class="panel-body inline">
                <button id="reset-button" type="button" class="secondary">
                    Anwendung zurücksetzen
                </button>
                <p class="hint">Löscht importierte Daten, generierte Abrechnung und lokale Speicherung.</p>
            </div>
        </section>
    </main>

    <footer class="app-footer">
        <p>
            Läuft lokal über XAMPP. Excel‑Verarbeitung mit SheetJS, Zustand mit ES6‑Modulen und localStorage.
        </p>
    </footer>

    <!-- SheetJS Library -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>

    <!-- Application Modules -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
